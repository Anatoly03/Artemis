<div>
    <form name="createForm" #createForm="ngForm" role="form">
        <div class="form-step" [hidden]="currentStep < 1">
            <h1>Title</h1>
            <p>Add a title and meaningful description to the new lecture.</p>
            <div class="form-group">
                <label class="form-control-label" jhiTranslate="artemisApp.lecture.title" for="field_title">Title</label>
                <input required [disabled]="currentStep > 2" type="text" class="form-control" name="title" id="field_title" [(ngModel)]="lecture.title" />
            </div>
            <div class="form-group" id="field_description">
                <label class="form-control-label" jhiTranslate="artemisApp.lecture.description" for="field_description">Description</label>
                <jhi-markdown-editor
                    class="markdown-editor"
                    [domainCommands]="domainCommandsDescription"
                    [(markdown)]="lecture.description"
                    [editorMode]="EditorMode.LATEX"
                    [disabled]="currentStep > 2"
                ></jhi-markdown-editor>
            </div>
        </div>
        <div class="form-step" [hidden]="currentStep < 2">
            <h1>Period</h1>
            <p>Specify the begin and end dates of the lecture.</p>
            <div class="d-flex">
                <div class="form-group flex-grow-1">
                    <jhi-date-time-picker
                        labelName="{{ 'artemisApp.lecture.startDate' | artemisTranslate }}"
                        [(ngModel)]="lecture.startDate"
                        [disabled]="currentStep > 2"
                        name="startDate"
                        id="start-date"
                    ></jhi-date-time-picker>
                </div>
                <div class="form-group flex-grow-1 ms-3">
                    <jhi-date-time-picker
                        labelName="{{ 'artemisApp.lecture.endDate' | artemisTranslate }}"
                        [(ngModel)]="lecture.endDate"
                        [disabled]="currentStep > 2"
                        name="endDate"
                        id="end-date"
                    ></jhi-date-time-picker>
                </div>
            </div>
        </div>
        <div class="form-step form-group" [hidden]="currentStep < 3">
            <h1>Attachments</h1>
            <p>Upload attachments to this lecture.</p>
            <jhi-lecture-attachments *ngIf="currentStep >= 3" [lectureId]="lecture.id" [showHeader]="false"></jhi-lecture-attachments>
        </div>
        <div class="form-step" [hidden]="currentStep < 4">
            <h1>Units</h1>
            <p>Add content to the lecture by creating different kinds of lecture units.</p>
            <jhi-lecture-unit-management
                [lectureId]="this.lecture.id"
                [emitEditEvents]="true"
                (onEditLectureUnitClicked)="startEditLectureUnit($event)"
                [showCreationCard]="false"
                [showLearningGoals]="false"
            ></jhi-lecture-unit-management>
            <div class="form-group w-100 d-flex justify-content-start" *ngIf="!isAnyUnitFormOpen()">
                <jhi-unit-creation-card [emitEvents]="true" (onUnitCreationCardClicked)="onCreateLectureUnit($event)"></jhi-unit-creation-card>
            </div>
            <div *ngIf="isAnyUnitFormOpen()" class="form-group">
                <h4 *ngIf="!isEditingLectureUnit">New Lecture Unit</h4>
                <h4 *ngIf="isEditingLectureUnit">Edit Lecture Unit</h4>
                <jhi-text-unit-form
                    *ngIf="isTextUnitFormOpen"
                    [isEditMode]="isEditingLectureUnit"
                    [hasCancelButton]="true"
                    (onCancel)="onCloseLectureUnitForms()"
                    (formSubmitted)="createEditTextUnit($event)"
                    [formData]="textUnitFormData"
                ></jhi-text-unit-form>
                <jhi-video-unit-form
                    *ngIf="isVideoUnitFormOpen"
                    [isEditMode]="isEditingLectureUnit"
                    [hasCancelButton]="true"
                    (onCancel)="onCloseLectureUnitForms()"
                    (formSubmitted)="createEditVideoUnit($event)"
                    [formData]="videoUnitFormData"
                ></jhi-video-unit-form>
                <jhi-online-unit-form
                    *ngIf="isOnlineUnitFormOpen"
                    [isEditMode]="isEditingLectureUnit"
                    [hasCancelButton]="true"
                    (onCancel)="onCloseLectureUnitForms()"
                    (formSubmitted)="createEditOnlineUnit($event)"
                    [formData]="onlineUnitFormData"
                ></jhi-online-unit-form>
                <jhi-attachment-unit-form
                    *ngIf="isAttachmentUnitFormOpen"
                    [isEditMode]="isEditingLectureUnit"
                    [hasCancelButton]="true"
                    (onCancel)="onCloseLectureUnitForms()"
                    (formSubmitted)="createEditAttachmentUnit($event)"
                    [formData]="attachmentUnitFormData"
                ></jhi-attachment-unit-form>
                <jhi-create-exercise-unit
                    *ngIf="isExerciseUnitFormOpen"
                    [shouldNavigateOnSubmit]="false"
                    (onExerciseUnitCreated)="onExerciseUnitCreated($event)"
                    [lectureId]="lecture.id"
                    [courseId]="lecture.course?.id"
                    [hasCancelButton]="true"
                    (onCancel)="onCloseLectureUnitForms()"
                ></jhi-create-exercise-unit>
            </div>
        </div>
        <div class="form-step form-group" [hidden]="currentStep < 5">
            <h1>Learning Goals</h1>
            <p>Make it easily visible what knowledge students will achieve when completing the units of this lecture by connecting them to learning goals.</p>
            <div class="row">
                <div class="col-12">
                    <td class="table-responsive" *ngIf="learningGoals && learningGoals.length > 0">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th><span>ID</span></th>
                                    <th><span>Title</span></th>
                                    <th><span>Connected Units</span></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let learningGoal of learningGoals; trackBy: trackLearningGoalId" class="position-relative">
                                    <td>
                                        {{ learningGoal.id }}
                                        <div *ngIf="currentlyProcessedLearningGoal?.id === learningGoal?.id" class="edit-overlay">
                                            {{ 'artemisApp.lecture.attachments.isBeingEdited' | artemisTranslate }}
                                        </div>
                                    </td>
                                    <td>{{ learningGoal.title }}</td>
                                    <td>{{ getConnectedUnitsForLearningGoal(learningGoal) }}</td>
                                    <td class="text-end">
                                        <div class="flex-btn-group-container">
                                            <button type="submit" (click)="startEditLearningGoal(learningGoal)" class="btn btn-primary btn-sm me-1">
                                                <fa-icon [icon]="faPencilAlt"></fa-icon>
                                                <span class="d-none d-md-inline" jhiTranslate="entity.action.edit">Edit</span>
                                            </button>
                                            <button
                                                *ngIf="lecture.isAtLeastInstructor"
                                                jhiDeleteButton
                                                [entityTitle]="learningGoal?.title || ''"
                                                deleteQuestion="artemisApp.attachment.deleteQuestion"
                                                [dialogError]="dialogError$"
                                                (delete)="deleteLearningGoal(learningGoal)"
                                            ></button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </div>
            </div>
            <div *ngIf="isLoadingLearningGoals" class="d-flex justify-content-center">
                <div class="spinner-border" role="status">
                    <span class="sr-only">{{ 'loading' | artemisTranslate }}</span>
                </div>
            </div>
            <div class="form-group" *ngIf="!isEditingLearningGoal">
                <button id="addLearningGoalButton" class="btn btn-primary" type="button" [disabled]="isAddingLearningGoal" (click)="showCreateLearningGoal()">
                    <span>{{ 'artemisApp.learningGoal.createLearningGoal.title' | artemisTranslate }}</span>
                </button>
            </div>
            <div *ngIf="isLoadingLearningGoalForm" class="d-flex justify-content-center">
                <div class="spinner-border" role="status">
                    <span class="sr-only">{{ 'loading' | artemisTranslate }}</span>
                </div>
            </div>
            <jhi-learning-goal-form
                *ngIf="(isAddingLearningGoal || isEditingLearningGoal) && !isLoadingLearningGoalForm"
                [isEditMode]="isEditingLearningGoal"
                [formData]="learningGoalFormData"
                (formSubmitted)="onLearningGoalFormSubmitted($event)"
                [hasCancelButton]="true"
                (onCancel)="onLearningGoalFormCanceled()"
                [courseId]="lecture.course!.id!"
                [lecturesOfCourseWithLectureUnits]="[lecture]"
                [isInSingleLectureMode]="true"
            >
            </jhi-learning-goal-form>
        </div>

        <!-- Bottom Navigation Bar -->
        <div class="d-flex align-items-center">
            <div class="me-3">
                <button type="button" id="back" [disabled]="isSaving" class="btn btn-secondary" (click)="toggleWizardMode()">
                    <fa-icon [icon]="faHandShakeAngle"></fa-icon>&nbsp;<span jhiTranslate="artemisApp.lecture.home.switchToTraditionalModeLabel">Switch to normal mode</span>
                </button>
            </div>
            <div class="flex-grow-1 d-flex justify-content-center">
                <div class="step" [class.completed]="isCompleted(1)" [class.current]="isCurrent(1)"></div>
                <div class="step" [class.completed]="isCompleted(2)" [class.current]="isCurrent(2)"></div>
                <div class="step" [class.completed]="isCompleted(3)" [class.current]="isCurrent(3)"></div>
                <div class="step" [class.completed]="isCompleted(4)" [class.current]="isCurrent(4)"></div>
                <div class="step" [class.completed]="isCompleted(5)" [class.current]="isCurrent(5)"></div>
            </div>
            <div class="ms-3">
                <button type="button" id="next" [disabled]="createForm.form.invalid || isSaving" class="btn btn-primary" (click)="next()">
                    <fa-icon [icon]="getNextIcon()"></fa-icon>&nbsp;<span [jhiTranslate]="getNextText()">Next</span>
                </button>
            </div>
        </div>
    </form>
</div>
